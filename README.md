# CG Cache

## Base Test Framework

TIGER (2023, WWW): A TGNN model with adaptive neighborhood sampling.

Some implementation details:
- Class `NumericalFeature` moves all edge and node features to GPU before model computation.
- Class `ComputationGraph` contains only CG structures (nids, eids, tss).
- The layers in TIGER are arranged by 0-th, L-th, L-1-th, ..., 1-st.

## CG Cache

For each node, we cache its all layers of neighbor nids, tss, and eids.

The cached data is modified incrementally by discarding outdated neighbors' cgs and adding new neighbors' cgs.

## Implementation

- Use GPU tensor apis if possible (e.g. scatter, gather). 

# Logs

```
nids[:10] [1035 1086   18  957   89  880   89  880  873 1035]
ts[:10] [170031. 170048. 170050. 170050. 170057. 170072. 170082. 170088. 170108.
 170113.]
len layers: 3
per layer: 3, type: <class 'list'>
0 -> (600,), <class 'numpy.ndarray'>
nids [1035 1086   18  957   89  880   89  880  873 1035]
1 -> (6000, 10), <class 'numpy.ndarray'>
nids [[1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]
 [1035 1035 1035 1035 1035 1035 1035 1035 1035 1035]]
eids [[6781 6785 6788 6790 6793 7086 7087 7089 7095 7120]
 [6785 6788 6790 6793 7086 7087 7089 7095 7120 7126]
 [6788 6790 6793 7086 7087 7089 7095 7120 7126 7127]
 [6790 6793 7086 7087 7089 7095 7120 7126 7127 7129]
 [6793 7086 7087 7089 7095 7120 7126 7127 7129 7148]
 [7086 7087 7089 7095 7120 7126 7127 7129 7148 7158]
 [7087 7089 7095 7120 7126 7127 7129 7148 7158 7163]
 [7089 7095 7120 7126 7127 7129 7148 7158 7163 7165]
 [7095 7120 7126 7127 7129 7148 7158 7163 7165 7169]
 [7120 7126 7127 7129 7148 7158 7163 7165 7169 7170]]
tss [[162333. 162396. 162476. 162505. 162545. 167976. 167994. 168017. 168142.
  168498.]
 [162396. 162476. 162505. 162545. 167976. 167994. 168017. 168142. 168498.
  168606.]
 [162476. 162505. 162545. 167976. 167994. 168017. 168142. 168498. 168606.
  168644.]
 [162505. 162545. 167976. 167994. 168017. 168142. 168498. 168606. 168644.
  168683.]
 [162545. 167976. 167994. 168017. 168142. 168498. 168606. 168644. 168683.
  168900.]
 [167976. 167994. 168017. 168142. 168498. 168606. 168644. 168683. 168900.
  169112.]
 [167994. 168017. 168142. 168498. 168606. 168644. 168683. 168900. 169112.
  169217.]
 [168017. 168142. 168498. 168606. 168644. 168683. 168900. 169112. 169217.
  169240.]
 [168142. 168498. 168606. 168644. 168683. 168900. 169112. 169217. 169240.
  169285.]
 [168498. 168606. 168644. 168683. 168900. 169112. 169217. 169240. 169285.
  169302.]]
2 -> (600, 10), <class 'numpy.ndarray'>
nids [[8694 8694 8694 8694 8694 8694 8694 8694 8694 8694]
 [   0    0    0    0    0    0    0    0    0    0]
 [8590 8276 8638 8623 8412 8427 8412 8683 8247 8677]
 [8676 8676 8676 8676 8676 8676 8676 8676 8676 8676]
 [8661 8661 8661 8661 8661 8661 8661 8661 8661 8661]
 [8655 8655 8655 8655 8655 8655 8655 8655 8655 8655]
 [8661 8661 8661 8661 8661 8661 8661 8661 8661 8661]
 [8655 8655 8655 8655 8655 8655 8655 8655 8655 8655]
 [   0    0    0    0    0    0    0 8651 8651 8651]
 [8694 8694 8694 8694 8694 8694 8694 8694 8694 8694]]
eids [[7126 7127 7129 7148 7158 7163 7165 7169 7170 7173]
 [   0    0    0    0    0    0    0    0    0    0]
 [4177 4877 5043 5421 5974 6051 6114 6293 6550 6939]
 [6854 6902 6956 7050 7064 7073 7153 7154 7174 7189]
 [5903 5932 5969 5983 5986 5993 5994 6002 6038 7213]
 [6420 6423 6484 6488 6497 6534 7128 7131 7137 7140]
 [5903 5932 5969 5983 5986 5993 5994 6002 6038 7213]
 [6420 6423 6484 6488 6497 6534 7128 7131 7137 7140]
 [   0    0    0    0    0    0    0 5312 6191 6276]
 [7126 7127 7129 7148 7158 7163 7165 7169 7170 7173]]
tss [[168606. 168644. 168683. 168900. 169112. 169217. 169240. 169285. 169302.
  169351.]
 [     0.      0.      0.      0.      0.      0.      0.      0.      0.
       0.]
 [106658. 124186. 127721. 138587. 148451. 149743. 150750. 153558. 157360.
  165616.]
 [164025. 165179. 165917. 167428. 167684. 167779. 169018. 169050. 169422.
  169614.]
 [146982. 147634. 148367. 148528. 148574. 148638. 148663. 148736. 149547.
  170025.]
 [155100. 155148. 156226. 156293. 156467. 157153. 168673. 168690. 168722.
  168741.]
 [146982. 147634. 148367. 148528. 148574. 148638. 148663. 148736. 149547.
  170025.]
 [155100. 155148. 156226. 156293. 156467. 157153. 168673. 168690. 168722.
  168741.]
 [     0.      0.      0.      0.      0.      0.      0. 135879. 152160.
  153291.]
 [168606. 168644. 168683. 168900. 169112. 169217. 169240. 169285. 169302.
  169351.]]
```